<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Paint-By-Numbers Solver">
<meta name="keywords" content="Python,Brython">
<meta name="author" content="Peter Monaco">
<meta charset="iso-8859-1">
<script type="text/javascript" src="../Brython/brython.js"></script>
</head>

<body onload="brython()">
<script type="text/python3">
from browser import document as doc
from browser import alert


gridCanvas = doc["clock"]
rowTextCanvas = doc["rowText"]
cellSize = 16


class A_Board:

  def __init__(self):
    self.num_col = int(doc["numCols"].value)
    self.num_row = int(doc["numRows"].value)

  def redraw(self):
    ctx = gridCanvas.getContext("2d")
    # Draw the grid
    ctx.clearRect(0, 0, gridCanvas.width, gridCanvas.height)
    ctx.beginPath();
    height = cellSize * self.num_row
    width = cellSize * self.num_col
    draw_filled_rect(ctx, 0, 0, width+.5, height+.5, 'gray')
    ctx.strokeStyle = 'black'
    for x in range(0,self.num_col+1):
        ctx.moveTo(x*cellSize+.5, .5)
        ctx.lineTo(x*cellSize+.5, height+.5)
    for y in range(0,self.num_row+1):
        ctx.moveTo(.5, y*cellSize+.5)
        ctx.lineTo(width+.5, y*cellSize+.5)
    ctx.lineWidth = 1
    ctx.stroke()
    set_cell(3,4,'_')
    set_cell(5,6,'X')

    # Draw the rowText
    ctx = rowTextCanvas.getContext("2d")
    ctx.clearRect(0, 0, rowTextCanvas.width, rowTextCanvas.height)
    ctx.beginPath();
    height = cellSize * self.num_row
    width = rowTextCanvas.width
    ctx.strokeStyle = 'black'
    for x in (0, width-1):
        ctx.moveTo(x+.5, .5)
        ctx.lineTo(x+.5, height+.5)
    for y in range(0,self.num_row+1):
        ctx.moveTo(.5, y*cellSize+.5)
        ctx.lineTo(width+.5, y*cellSize+.5)
    ctx.lineWidth = 1
    ctx.stroke()

  def write_row_text(self, rowNum, text):
    x = 5
    y = rowNum * cellSize - 2
    ctx = rowTextCanvas.getContext("2d")
    ctx.font = "15px Arial";
    ctx.fillText(text, x, y);


def draw_filled_rect(ctx, x, y, dx, dy, color):
    ctx.beginPath()
    ctx.rect(x, y, dx, dy)
    ctx.fillStyle = color
    ctx.strokeStyle = color
    ctx.fill()
    ctx.stroke()

# expected values for 'val' are '_', 'X'
def set_cell(col, row, val):
    # If ? or _, fill with white.  Else fill black.
    # Then, if ?, put a little dot in the middle
    ctx = gridCanvas.getContext("2d")
    upLeftX = col * cellSize + 1.5
    upLeftY = row * cellSize + 1.5
    color = 'white'
    if (val == 'X'):
        color = 'black'
    draw_filled_rect(ctx, upLeftX, upLeftY, cellSize-2, cellSize-2, color)


def nBlanks(n):
  return '_________________________________________________________________________'[:n]

def nFilled(n):
  return 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'[:n]

# Function, used recursively to help expand_pattern_root()
# total_len is an int, and pieces is an array of ints.
def expand_pattern(total_len, pieces):
  answers = []
  min_len = sum(pieces) + len(pieces) - 1
  for startPt in range(0, total_len-min_len+1):
    prefix = nBlanks(startPt) + nFilled(pieces[0])
    if (len(pieces) > 1):
      prefix += '_'
      endings = expand_pattern(total_len-len(prefix), pieces[1:])
      for ending in endings:
        answers.append(prefix + ending)
    else:
      answers.append(prefix + nBlanks(total_len-len(prefix)))
  return answers

class OptionSet:
  def __init__(self, dimension, pattern):
    # Eg, pattern = "8 3 1"
    # Given 20 and '8 1 3', return a set of 20-character
    # strings, such as '__XXXXXXXX__X_XXX__', each representing one
    # way to fit groups of 8, 1, and 3 X's within 20 chars.
    pieces = [int(s) for s in pattern.split(' ')]
    self.dim = dimension
    self.options = expand_pattern(dimension, pieces)

  def numOptions(self):
    return len(self.options)

  # Looks through char #iChar of all the options
  # If all chars are the same, return that char.
  # Else return '?'
  def consensusOfChar(self, iChar):
    c = self.options[0][iChar]
    for iStr in range(1, len(self.options)):
      c2 = self.options[iStr][iChar]
      if (c2 != c):
        return '?'
    return c

  def consensus(self):
    if (len(self.options) == 0):
      return "No Options in this OptionSet"
    answer = "";
    # iterate through the first char of all strings.  Then the second char, etc.
    for iChar in range(0, self.dim):
      answer += self.consensusOfChar(iChar)
    return answer

  # Call this to inform the OptionSet that the value at
  # position #i is a '_' or 'X'.  It will remove options
  # accordingly.  'i' is zero-based
  def constrain(self, i, v):
    for index in reversed(range(len(self.options))):
      if (self.options[index][i] != v):
        self.options.pop(index)
  
  def print(self):
    print(self.options)

###
### Define *THE* Board
###
theBoard = A_Board()

def rowTextClicked(event):
    canvasRect = rowTextCanvas.getBoundingClientRect()
    x = event.x - canvasRect.left
    y = event.y - canvasRect.top
    #alert("x: " + str(x)+", y: "+str(y))
    rowNum = int(y/cellSize) + 1
    theBoard.write_row_text(rowNum, "Click!")


def drawTheBoard():
  theBoard = A_Board()
  theBoard.redraw()

doc["test"].bind("click", drawTheBoard)
doc["numCols"].bind("change", drawTheBoard)
doc["numRows"].bind("change", drawTheBoard)
doc["rowText"].bind("click", rowTextClicked)

theBoard.redraw()
theBoard.write_row_text(5, "R5")
theBoard.write_row_text(6, "1 1 1 1 1 1")



a = OptionSet(20, "10 3 1")
a.print()
b = OptionSet(20, "17")
print(b.options)
print(b.numOptions())
print(b.consensus())
print('--------------')
b.constrain(1, 'X')
b.print()
print(b.consensus())
print('------------')
print(a.consensus())
a.constrain(11, '_')
a.constrain(16, '_')
a.print()
print(a.consensus())




</script>
<table>
  <tr>
    <td></td>
    <td>

<h3>Columns</h3>
<table>
<tr><td>Number:   </td><td> <input id="numCols" value=20>    </td></tr>
<tr><td valign="top">Patterns:   </td><td> <textarea rows="4" cols="50">Patterns go here...</textarea>   </td></tr>
</table>

    </td>
  </tr>
  <tr>
    <td valign="top">

<h3>Rows</h3>
<table>
<tr><td>Number:   </td><td> <input id="numRows" value=20>    </td></tr>
<tr><td> <button id="test">Redraw!</button>   </td></tr>
</table>

    </td>
    <td>

<canvas width="100" height="500" id="rowText"></canvas>
<canvas width="500" height="500" id="clock"></canvas>


    </td>
  </tr>


</table>

</body>

</html>
